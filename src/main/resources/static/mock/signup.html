<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>ì„ì‹œ ì¹´ì¹´ì˜¤ ê°€ì…</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root { --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --bg:#ffffff; --ok:#10b981; --err:#ef4444; }
        * { box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; color: var(--fg); background: var(--bg); }
        .wrap { max-width: 560px; margin: 0 auto; }
        .card { border:1px solid var(--line); border-radius: 12px; padding: 18px; }
        h1 { font-size: 20px; margin: 0 0 12px; }
        .muted { color: var(--muted); font-size: 14px; margin-bottom: 16px; }
        .row { display: grid; grid-template-columns: 140px 1fr; gap: 10px; margin-bottom: 12px; align-items: center; }
        label { font-weight: 600; }
        input { padding: 10px 12px; border: 1px solid var(--line); border-radius: 8px; width: 100%; }
        button { padding: 10px 14px; border-radius: 8px; border: 0; background: var(--fg); color: #fff; cursor: pointer; }
        button[disabled] { opacity:.6; cursor:not-allowed; }
        .links { display:flex; gap:8px; margin-top:10px;}
        .links a { font-size:14px; color:#2563eb; text-decoration:none; }
        .links a:hover { text-decoration:underline; }
        .alert { border-radius:8px; padding:10px 12px; font-size:14px; margin-bottom:12px; display:none; }
        .alert.ok { background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; }
        .alert.err { background:#fef2f2; color:#991b1b; border:1px solid #fecaca; }
        pre { background:#0b1020; color:#d1d5db; padding:12px; border-radius:8px; margin-top:16px; overflow:auto; font-size:12px; }
    </style>
</head>
<body>
<div class="wrap">
    <div class="card">
        <h1>ì¹´ì¹´ì˜¤ ì‹ ê·œ íšŒì›ê°€ì…</h1>
        <p class="muted">
            ì´ í¼ì€ ê°€ê³µ ì—†ì´ ì…ë ¥ê°’ì„ ê·¸ëŒ€ë¡œ ì„œë²„ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
            <br>ìš”ì²­ ì‹œ <code>kakao_signup</code> ì¿ í‚¤ê°€ ìë™ìœ¼ë¡œ í•¨ê»˜ ì „ì†¡ë˜ì–´ì•¼ í•©ë‹ˆë‹¤(ë°±ì—”ë“œì—ì„œ HttpOnlyë¡œ ì„¸íŒ…ë¨).
        </p>

        <div id="alert-ok"  class="alert ok"></div>
        <div id="alert-err" class="alert err"></div>

        <form id="signupForm">
            <div class="row">
                <label for="name">ì´ë¦„</label>
                <input id="name" name="name" autocomplete="name" required />
            </div>

            <div class="row">
                <label for="phone">ì „í™”ë²ˆí˜¸</label>
                <input id="phone" name="phone" placeholder="010-1234-5678" autocomplete="tel" required />
            </div>

            <div class="row">
                <label for="residentNum">ì£¼ë¯¼ë²ˆí˜¸(ì•6-ë’¤1)</label>
                <input id="residentNum" name="residentNum" placeholder="ì˜ˆ: 990101-1" required />
            </div>

            <div class="row">
                <label for="address">ì£¼ì†Œ</label>
                <input id="address" name="address" required />
            </div>

            <div class="row">
                <label for="zipCode">ìš°í¸ë²ˆí˜¸</label>
                <input id="zipCode" name="zipCode" required />
            </div>

            <button id="btnSubmit" type="submit">ê°€ì…</button>
        </form>

        <div class="links">
            <a href="/api/auth/kakao/authorize">ì¹´ì¹´ì˜¤ ì¬ì¸ì¦</a>
            <a href="/api/auth/kakao/authorize?force=true">ì¹´ì¹´ì˜¤ ì¬ì¸ì¦(ê³„ì •ì„ íƒ ê°•ì œ)</a>
            <a href="/login.html">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ</a>
        </div>

        <pre id="out">ì‘ë‹µì´ ì—¬ê¸°ì— ì¶œë ¥ë©ë‹ˆë‹¤â€¦</pre>
    </div>
</div>

<script>
    const $ = (id) => document.getElementById(id);
    const form = $("signupForm");
    const out  = $("out");
    const ok   = $("alert-ok");
    const err  = $("alert-err");
    const btn  = $("btnSubmit");

    function show(el, msg) { el.textContent = msg; el.style.display = "block"; }
    function hide(el){ el.style.display = "none"; }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      hide(ok); hide(err);
      btn.disabled = true;

      const payload = {
        name: form.name.value,
        phone: form.phone.value,
        userProfile: {
          residentNum: form.residentNum.value,
          address: form.address.value,
          zipCode: form.zipCode.value
        }
      };

      try {
        const res = await fetch('/api/auth/kakao/signupUser', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include', // kakao_signup ì¿ í‚¤ ë™ë´‰
          body: JSON.stringify(payload)
        });

        const contentType = res.headers.get('content-type') || '';
        const body = contentType.includes('application/json') ? await res.json() : await res.text();

        if (res.ok) {
          show(ok, 'ê°€ì… ì„±ê³µ ğŸ‰ ì´ì œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ìˆì–´ìš”.');
        } else {
          const msg = typeof body === 'string' ? body : (body.message || JSON.stringify(body, null, 2));
          show(err, `ê°€ì… ì‹¤íŒ¨ (${res.status}) - ${msg}`);
        }
        out.textContent = typeof body === 'string' ? body : JSON.stringify(body, null, 2);
      } catch (ex) {
        show(err, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + (ex?.message || ex));
        out.textContent = (ex?.stack || ex);
      } finally {
        btn.disabled = false;
      }
    });

    // ì°¸ê³ : HttpOnly ì¿ í‚¤ëŠ” JSë¡œ ì½ì„ ìˆ˜ ì—†ìœ¼ë‹ˆ ì—¬ê¸°ì„œ í™•ì¸ ë¶ˆê°€. í•„ìš” ì‹œ ì„œë²„ ì‘ë‹µìœ¼ë¡œ íŒë‹¨í•˜ì„¸ìš”.
</script>
</body>
</html>
